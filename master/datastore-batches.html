<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Batches &mdash; gcloud 290b09e documentation</title>
    
    <link rel="stylesheet" href="_static/css/main.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/normalize.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/github.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '290b09e',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/js/vendor/modernizr-2.6.2.min.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="gcloud 290b09e documentation" href="index.html" />
    <link rel="next" title="Dataset" href="datastore-dataset.html" />
    <link rel="prev" title="Transactions" href="datastore-transactions.html" /> 
  </head>
  <body role="document">
    <header class="page-header fixed" role="banner">
      <h1 class="logo">
        <a href="index.html" title="back to home">
          <img src="_static/images/logo.svg" alt="Google Cloud Platform" />
          <span class="gcloud">gcloud</span>
        </a>
      </h1>
      <nav class="main-nav">
        <div class="nav-current">Python</div>
        <ul class="menu">
          <li>
            <a href="
https://googlecloudplatform.github.io/gcloud-node" title="Node.js docs page">
              <img src="_static/images/icon-lang-nodejs.svg" alt="Node.js icon" class="menu-icon" />
              Node.js
            </a>
          </li>
          <li>
            <a href="#" title="Python docs page">
              <img src="_static/images/icon-lang-python.svg" alt="Python icon" class="menu-icon" />
              Python
            </a>
          </li>
        </ul>
      </nav><!-- end of .main-nav -->
      <a href="https://github.com/GoogleCloudPlatform/gcloud-python/issues/new?title=%5BDocumentation+Issue%5D+&body=Page+Name%3A+datastore-batches%0ARelease%3A%20290b09e" target="_blank" class="v-btn" id="file-issue">
        <img src="_static/images/icon-link-github.svg" />
        Report an Issue
      </a>
    </header><!-- end of .page-header -->
    
      <article class="main lang-page" role="main">

      <header class="docs-header">
        <h1 class="page-title">Python</h1>

          <div class="versions">
            <a href="/gcloud-python/versions.html" class="v-btn">
              <img src="_static/images/icon-arrow-bullet.svg" />
              Version History (290b09e)
            </a>
          </div><!-- end of .versions -->
          <div>
            <a href="https://github.com/GoogleCloudPlatform/gcloud-python/issues/new?title=%5BDocumentation+Issue%5D+" target="_blank" class="v-btn" id="file-issue-secondary">
              <img src="_static/images/icon-link-github.svg" />
              Report an Issue
            </a>
          </div>
      </header>

      <section class="content">
        
  <div class="section" id="module-gcloud.datastore.batch">
<span id="batches"></span><h1>Batches<a class="headerlink" href="#module-gcloud.datastore.batch" title="Permalink to this headline">#</a></h1>
<p>Create / interact with a batch of updates / deletes.</p>
<p>Batches provide the ability to execute multiple operations
in a single request to the Cloud Datastore API.</p>
<p>See
<a class="reference external" href="https://cloud.google.com/datastore/docs/concepts/entities#Datastore_Batch_operations">https://cloud.google.com/datastore/docs/concepts/entities#Datastore_Batch_operations</a></p>
<dl class="class">
<dt id="gcloud.datastore.batch.Batch">
<em class="property">class </em><code class="descclassname">gcloud.datastore.batch.</code><code class="descname">Batch</code><span class="sig-paren">(</span><em>dataset_id=None</em>, <em>connection=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gcloud/datastore/batch.html#Batch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gcloud.datastore.batch.Batch" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>An abstraction representing a collected group of updates / deletes.</p>
<p>Used to build up a bulk mutuation.</p>
<p>For example, the following snippet of code will put the two <code class="docutils literal"><span class="pre">save</span></code>
operations and the delete operatiuon into the same mutation, and send
them to the server in a single API request:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">gcloud.datastore.batch</span> <span class="kn">import</span> <span class="n">Batch</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span> <span class="o">=</span> <span class="n">Batch</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">entity1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">entity2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">key3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<p>You can also use a batch as a context manager, in which case the
<code class="docutils literal"><span class="pre">commit</span></code> will be called automatically if its block exits without
raising an exception:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Batch</span><span class="p">()</span> <span class="k">as</span> <span class="n">batch</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">batch</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">entity1</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">batch</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">entity2</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">batch</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">key3</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, no updates will be sent if the block exits with an error:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Batch</span><span class="p">()</span> <span class="k">as</span> <span class="n">batch</span><span class="p">:</span>
<span class="gp">... </span>  <span class="n">do_some_work</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
<span class="gp">... </span>  <span class="k">raise</span> <span class="ne">Exception</span><span class="p">()</span> <span class="c"># rolls back</span>
</pre></div>
</div>
<p>Construct a batch.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>dataset_id</strong> (<code class="xref py py-class docutils literal"><span class="pre">str</span></code>.) &#8211; The ID of the dataset.</li>
<li><strong>connection</strong> (<a class="reference internal" href="datastore-api.html#gcloud.datastore.connection.Connection" title="gcloud.datastore.connection.Connection"><code class="xref py py-class docutils literal"><span class="pre">gcloud.datastore.connection.Connection</span></code></a>) &#8211; The connection used to connect to datastore.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-class docutils literal"><span class="pre">ValueError</span></code> if either a connection or dataset ID
are not set.</p>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="gcloud.datastore.batch.Batch.add_auto_id_entity">
<code class="descname">add_auto_id_entity</code><span class="sig-paren">(</span><em>entity</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gcloud/datastore/batch.html#Batch.add_auto_id_entity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gcloud.datastore.batch.Batch.add_auto_id_entity" title="Permalink to this definition">#</a></dt>
<dd><p>Adds an entity to the list of entities to update with IDs.</p>
<p>When an entity has a partial key, calling <code class="docutils literal"><span class="pre">save()</span></code> adds an
insert_auto_id entry in the mutation.  In order to make sure we
update the Entity once the transaction is committed, we need to
keep track of which entities to update (and the order is
important).</p>
<p>When you call <code class="docutils literal"><span class="pre">save()</span></code> on an entity inside a transaction, if
the entity has a partial key, it adds itself to the list of
entities to be updated once the transaction is committed by
calling this method.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>entity</strong> (<a class="reference internal" href="datastore-entities.html#gcloud.datastore.entity.Entity" title="gcloud.datastore.entity.Entity"><code class="xref py py-class docutils literal"><span class="pre">gcloud.datastore.entity.Entity</span></code></a>) &#8211; The entity to be updated with a completed key.</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">ValueError if the entity&#8217;s key is alread completed.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gcloud.datastore.batch.Batch.begin">
<code class="descname">begin</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/gcloud/datastore/batch.html#Batch.begin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gcloud.datastore.batch.Batch.begin" title="Permalink to this definition">#</a></dt>
<dd><p>No-op</p>
<p>Overridden by <a class="reference internal" href="datastore-transactions.html#gcloud.datastore.transaction.Transaction" title="gcloud.datastore.transaction.Transaction"><code class="xref py py-class docutils literal"><span class="pre">gcloud.datastore.transaction.Transaction</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="gcloud.datastore.batch.Batch.commit">
<code class="descname">commit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/gcloud/datastore/batch.html#Batch.commit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gcloud.datastore.batch.Batch.commit" title="Permalink to this definition">#</a></dt>
<dd><p>Commits the batch.</p>
<p>This is called automatically upon exiting a with statement,
however it can be called explicitly if you don&#8217;t want to use a
context manager.</p>
</dd></dl>

<dl class="attribute">
<dt id="gcloud.datastore.batch.Batch.connection">
<code class="descname">connection</code><a class="headerlink" href="#gcloud.datastore.batch.Batch.connection" title="Permalink to this definition">#</a></dt>
<dd><p>Getter for connection over which the batch will run.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="datastore-api.html#gcloud.datastore.connection.Connection" title="gcloud.datastore.connection.Connection"><code class="xref py py-class docutils literal"><span class="pre">gcloud.datastore.connection.Connection</span></code></a></td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">The connection over which the batch will run.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="gcloud.datastore.batch.Batch.current">
<em class="property">static </em><code class="descname">current</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/gcloud/datastore/batch.html#Batch.current"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gcloud.datastore.batch.Batch.current" title="Permalink to this definition">#</a></dt>
<dd><p>Return the topmost batch / transaction, or None.</p>
</dd></dl>

<dl class="attribute">
<dt id="gcloud.datastore.batch.Batch.dataset_id">
<code class="descname">dataset_id</code><a class="headerlink" href="#gcloud.datastore.batch.Batch.dataset_id" title="Permalink to this definition">#</a></dt>
<dd><p>Getter for dataset ID in which the batch will run.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><code class="xref py py-class docutils literal"><span class="pre">str</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">The dataset ID in which the batch will run.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gcloud.datastore.batch.Batch.delete">
<code class="descname">delete</code><span class="sig-paren">(</span><em>key</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gcloud/datastore/batch.html#Batch.delete"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gcloud.datastore.batch.Batch.delete" title="Permalink to this definition">#</a></dt>
<dd><p>Remember a key to be deleted durring <code class="docutils literal"><span class="pre">commit</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>key</strong> (<a class="reference internal" href="datastore-keys.html#gcloud.datastore.key.Key" title="gcloud.datastore.key.Key"><code class="xref py py-class docutils literal"><span class="pre">gcloud.datastore.key.Key</span></code></a>) &#8211; the key to be deleted.</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">ValueError if key is not complete, or if the key&#8217;s
<code class="docutils literal"><span class="pre">dataset_id</span></code> does not match ours.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="gcloud.datastore.batch.Batch.mutation">
<code class="descname">mutation</code><a class="headerlink" href="#gcloud.datastore.batch.Batch.mutation" title="Permalink to this definition">#</a></dt>
<dd><p>Getter for the current mutation.</p>
<p>Every batch is committed with a single Mutation
representing the &#8216;work&#8217; to be done as part of the batch.
Inside a batch, calling <code class="docutils literal"><span class="pre">batch.put()</span></code> with an entity, or
<code class="docutils literal"><span class="pre">batch.delete</span></code> with a key, builds up the mutation.
This getter returns the Mutation protobuf that
has been built-up so far.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><code class="xref py py-class docutils literal"><span class="pre">gcloud.datastore._datastore_v1_pb2.Mutation</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">The Mutation protobuf to be sent in the commit request.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gcloud.datastore.batch.Batch.put">
<code class="descname">put</code><span class="sig-paren">(</span><em>entity</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gcloud/datastore/batch.html#Batch.put"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gcloud.datastore.batch.Batch.put" title="Permalink to this definition">#</a></dt>
<dd><p>Remember an entity&#8217;s state to be saved during <code class="docutils literal"><span class="pre">commit</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Any existing properties for the entity will be replaced by those
currently set on this instance.  Already-stored properties which do
not correspond to keys set on this instance will be removed from
the datastore.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Property values which are &#8220;text&#8221; (&#8216;unicode&#8217; in Python2, &#8216;str&#8217; in
Python3) map to &#8216;string_value&#8217; in the datastore;  values which are
&#8220;bytes&#8221; (&#8216;str&#8217; in Python2, &#8216;bytes&#8217; in Python3) map to &#8216;blob_value&#8217;.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>entity</strong> (<a class="reference internal" href="datastore-entities.html#gcloud.datastore.entity.Entity" title="gcloud.datastore.entity.Entity"><code class="xref py py-class docutils literal"><span class="pre">gcloud.datastore.entity.Entity</span></code></a>) &#8211; the entity to be saved.</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">ValueError if entity has no key assigned, or if the key&#8217;s
<code class="docutils literal"><span class="pre">dataset_id</span></code> does not match ours.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gcloud.datastore.batch.Batch.rollback">
<code class="descname">rollback</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/gcloud/datastore/batch.html#Batch.rollback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gcloud.datastore.batch.Batch.rollback" title="Permalink to this definition">#</a></dt>
<dd><p>No-op</p>
<p>Overridden by <a class="reference internal" href="datastore-transactions.html#gcloud.datastore.transaction.Transaction" title="gcloud.datastore.transaction.Transaction"><code class="xref py py-class docutils literal"><span class="pre">gcloud.datastore.transaction.Transaction</span></code></a>.</p>
</dd></dl>

</dd></dl>

</div>


      </section><!-- end of .content -->
      <nav class="side-nav">
        <ul><li><a href="index.html">gcloud</a></li></ul>
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gcloud-api.html">GCloud Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="datastore-api.html">Datastore</a></li>
<li class="toctree-l1"><a class="reference internal" href="datastore-entities.html">Entities</a></li>
<li class="toctree-l1"><a class="reference internal" href="datastore-keys.html">Keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="datastore-queries.html">Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="datastore-transactions.html">Transactions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Batches</a></li>
<li class="toctree-l1"><a class="reference internal" href="datastore-dataset.html">Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage-api.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage-blobs.html">Blobs / Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage-buckets.html">Buckets</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage-acl.html">ACL</a></li>
<li class="toctree-l1"><a class="reference internal" href="pubsub-usage.html">Using the API</a></li>
<li class="toctree-l1"><a class="reference internal" href="pubsub-api.html">Pub/Sub</a></li>
<li class="toctree-l1"><a class="reference internal" href="pubsub-subscription.html">Subscriptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="pubsub-topic.html">Topics</a></li>
</ul>

        <ul class="external-links">
          <li>
            <a href="https://github.com/GoogleCloudPlatform/gcloud-python/" title="Python on Github">
              <img src="_static/images/icon-link-github.svg" alt="Github icon" />
              Github
            </a>
          </li>
          <li>
            <a href="https://github.com/GoogleCloudPlatform/gcloud-python/issues" title="Python issues on Github">
              <img src="_static/images/icon-link-github.svg" alt="Github icon" />
              Issues
            </a>
          </li>
          <li>
            <a href="http://stackoverflow.com/questions/tagged/gcloud-python" title="gcloud on StackOverflow">
              <img src="_static/images/icon-link-stackoverflow.svg" alt="StackOverflow icon" />
              gcloud
            </a>
          </li>
          <li>
            <a href="https://pypi.python.org/pypi/gcloud" title="Python package manager">
              <img src="_static/images/icon-link-package-manager.svg" alt="Package Manager icon" />
              Package Manager
            </a>
          </li>
        </ul>
      </nav><!-- end of .side-nav -->
    </article><!-- end of .main -->

    <script src="_static/js/vendor/jquery-1.10.2.min.js"></script>
    <script src="_static/js/plugins.js"></script>
    <script src="_static/js/main.js"></script>
  
  </body>
</html>